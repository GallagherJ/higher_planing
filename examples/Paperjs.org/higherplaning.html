<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Higher Planing</title>
    <link rel="stylesheet" href="../css/style.css">
    <script type="text/javascript" src="Tone.js"></script>
    <script type="text/javascript" src="jquery.min.js"></script>
    <script type="text/javascript" src="../../dist/paper-full.js"></script>
    <script type="text/paperscript" canvas="canvas">

        var mousePoint = view.center;
        var amount = 25;
        var color1 = 'purple'
        var color2 = 'white'
        var color3 = 'orange'
        var color4 = 'white'
        var colors = [color1, color2, color3, color4];
        var rate = 2;



//start tone audio control
var player = new Tone.Player({
    "url" : "chan1_cut.wav",
    "loop" : true,
"reverse" : true
}).toMaster();

var playdat = new Tone.Player({
    "url" : "obscurium_modulatron.wav",
    "loop" : true,
"reverse" : false,
"loopStart":0.4,
"loopEnd":2.4
}).toMaster();

var feedbackDelay = new Tone.FeedbackDelay("8n", 0.5).toMaster();
var dist = new Tone.PingPongDelay("4n", 0.2).toMaster();


var minus = player.volume.value;
minus = 1;

/*        var background = new Shape.Rectangle({
    rectangle: view.bounds,
    fillColor: { hue: 180, saturation: 1, brightness: 1 }
});*/

        for (var i = 0; i < amount; i++) {
            var rect = new Rectangle([0, 0], [25, 25]);
            rect.center = mousePoint;
            var path = new Path.Rectangle(rect, 6);
            path.fillColor = colors[i % 4];
            var scale = (1 - i / amount) * 20;
            path.scale(scale);
        }

 function drawemAgain(amount){

     project.activeLayer.removeChildren();
     console.log('up');

      for (var i = 0; i < amount; i++) {
            var rect = new Rectangle([0, 0], [amount, amount]);
            rect.center = mousePoint;
            var path = new Path.Rectangle(rect, 6);
            path.fillColor = colors[i % 4];
            var scale = (1 - i / amount) * 20;
            path.scale(scale);
        }

       

  //  var canyo  = document.getElementById("canvas");
   // var context = canyo.getContext("2d");

  //   context.clearRect(0, 0, canvas.width, canvas.height);

 //   var c=document.getElementById("canvas");

   // var ctx=c.getContext("2d");

    //anvas.clearRect(20,20,100,50);
}


 function drawemHexagon(amount){

     project.activeLayer.removeChildren();
     console.log('left');

     // Create a Paper.js Path to draw a line into it:
var hexagon = new Path();
// Color our path black
hexagon.fillColor = 'black';

// How many points do we want our object to have
var points = 6;
// How large should it be
var radius = 60;
// 0 to 2PI is a circle, so divide that by the number of points
// in our object and that's how many radians we should put a new
// point in order to draw the shape
var angle = ((2 * Math.PI) / points);

// For as many vertices in the shape, add a point
for(i = 0; i <= points; i++) {

  // Add a new point to the object
  hexagon.add(new Point(
    // Radius * Math.cos(number of radians of the point) is the x position
    radius * Math.cos(angle * i), 
    // And the same thing with Math.sin for the y position of the point
    radius * Math.sin(angle * i)
  ));
}

// Offset the shape so it's fully displayed on the canvas
hexagon.position.x += 200;
hexagon.position.y += 200;

for (var i = 0; i < amount; i++) {

var hex2 = hexagon.clone();
hex2.fillColor = colors[i % 4];
var scale = (1 - i / amount) * 20;
          //  hex2.scale(scale);

}

}
    /* 
    
             for (var i = 0; i < amount; i++) {
            var rect1 = new Rectangle([0, 0], [amount, amount]);
            rect1.center = mousePoint;
            var path1 = new Path.Rectangle(rect1, 6);
            path1.fillColor = colors[i % 4];
            var scale1 = (1 - i / amount) * 20;
            path1.scale1(scale1);
        }
 
   function  drawemBack(amount){

            for (var i = 0; i < amount; i++) {
            var rect2 = new Rectangle([0, 0], [25, 25]);
            rect2.center = mousePoint;
            var path2 = new Path.Rectangle(rect, 6);
            path2.fillColor = colors[i % 4];
            var scale2 = (1 - i / amount) * 20;
            path2.scale2(scale2);
        }




        }*/

        function onMouseMove(event) {
            mousePoint = event.point;
        }




     
//changing rate of spin
            document.getElementById ("mybody").addEventListener ("click", changeRate);
            


        function changeRate(){

            rate=9;
            console.log("2derp");
            player.connect(feedbackDelay);
            playdat.connect(dist);
            feedbackDelay.toMaster();
            dist.toMaster();
            
        document.getElementById ("mybody").removeEventListener ("click", changeRate);
        document.getElementById ("mybody").addEventListener ("click", slowRate);
        
            

        }

         function slowRate(){
            rate=2;
            feedbackDelay.disconnect();
            dist.disconnect();


             document.getElementById ("mybody").removeEventListener ("click", slowRate);
            document.getElementById ("mybody").addEventListener ("click", changeRate);
       
            console.log("3derp");
         }

         //end change spin rate
         


        document.onkeydown = checkKey;


//keypress
function checkKey(e) {

    e = e || window.event;

    if (e.keyCode == '38') {
        // up arrow
        // 
       colors = ['blue', 'cyan', 'blue', 'white'];
        drawemAgain(15);
        player.stop();
        playdat.start();
        rate = 2;
       // context.clearRect(0, 0, canvas.width, canvas.height);
      
    }
    else if (e.keyCode == '40') {
        // down arrow
        colors = ['purple', 'white', 'orange', 'white'];
        drawemAgain(25);
         
        console.log('down');
        playdat.stop();
        player.start();
         rate = 2;
        
    }
    else if (e.keyCode == '37') {
       drawemHexagon(2);
       //left arrow
    }
    else if (e.keyCode == '39') {
       // right arrow
    }

}

//end keypress
//
//
// modify paths start 




// The amount of segment points we want to create:
var amount = 1;

// The maximum height of the wave:
var height = 60;

// Create a new path and style it:
/*var path = new Path({
    // 80% black:
    strokeColor: [0.8],
    strokeWidth: 30,
    strokeCap: 'square'
});
*/

/*edit paths start

// Add 5 segment points to the path spread out
// over the width of the view:
for (var i = 0; i <= amount; i++) {
    path.insert(new Point(i / amount, 1) * view.size);
}

// Select the path, so we can see how it is constructed:
path.selected = true;

function onFrame(event) {
    // Loop through the segments of the path:
    for (var i = 0; i <= amount; i++) {
        var segment = path.segments[i];

        // A cylic value between -1 and 1
        var sinus = Math.sin(event.time * 3 + i);
        
        // Change the y position of the segment point:
        segment.point.x = sinus * height + 2;
    }
    // Uncomment the following line and run the script again
    // to smooth the path:
    // path.smooth();
}







 //modify paths end */
 //
 //
 //cool rotate circle thing
 //
 /*
var clones = 30;
var angle = 360 / clones;

for(var i = 0; i < clones; i++) {
    var clonedPath = circlePath.clone();
    clonedPath.rotate(angle * i, circlePath.bounds.topLeft);
}; */
 

var amand = 5;
var height = 60;

      var children = project.activeLayer.children;
        function onFrame(event) {
            for (var i = 0, l = children.length; i < l; i++) {
                var item = children[i];
                var delta = (mousePoint - item.position) / (i + 5);
                item.rotate(Math.sin((event.count + i) / 10) * rate);              
               //cool colour change thing, incorporate into diff. function.
               //item.fillColor.hue += 7;
                if (delta.length > 0.1)
                    item.position += delta;
            }

                        
        } 

        Tone.Buffer.onload = function(){
    player.start();
}
    </script>
</head>
<body id='mybody'>
    <canvas id="canvas" resize hidpi="off"></canvas>
</body>
</html>
